<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒãƒ³ã‚³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ eva</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®è¦‹ãŸç›®ã‚’èª¿æ•´ (ä»»æ„) */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 4px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4A90E2;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4A90E2;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-700 to-blue-900 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full transform transition-all duration-300 hover:scale-105">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-6 flex items-center justify-center">
            <span class="mr-3 text-yellow-500">ğŸ°</span> æœªæ¥ã¸ã®å’†å“®
        </h1>

        <p class="text-center text-gray-600 mb-8">
            ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨1å›åˆ†ã®ãƒ‘ãƒãƒ³ã‚³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
            ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã¯Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
        </p>

        <div class="mb-8 p-4 bg-gray-50 rounded-lg">
            <label for="revolutions" class="block text-lg font-semibold text-gray-700 mb-2">
                1000å††ã‚ãŸã‚Šã®å›è»¢æ•°: <span id="revolutionsValue" class="text-blue-600 font-bold">18</span>å›
            </label>
            <input type="range" id="revolutions" min="10" max="30" value="18" step="1"
                   class="w-full h-2 rounded-lg appearance-none cursor-pointer accent-blue-600 bg-gray-200">
        </div>

        <button id="simulateButton"
                class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:from-green-600 hover:to-teal-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-300 transform hover:scale-105">
            ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œï¼
        </button>

        <div id="loadingIndicator" class="hidden text-center mt-6 text-blue-600 font-semibold">
            <svg class="animate-spin h-6 w-6 mr-3 inline-block" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­...
        </div>

        <div id="resultContainer" class="mt-8 p-6 bg-blue-50 rounded-lg border-l-4 border-blue-500 shadow-md hidden">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">--- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ ---</h2>
            <p class="text-gray-700 mb-2"><strong>åˆå½“ãŸã‚Šã¾ã§ã®å›è»¢æ•°</strong>: <span id="hitNum" class="font-semibold text-indigo-700"></span>å›</p>
            <p class="text-gray-700 mb-2"><strong>åˆæœŸæŠ•è³‡é¡</strong>: <span id="initialInvestment" class="font-semibold text-indigo-700"></span>å††</p>
            <p class="text-gray-700 mb-2"><strong>çµæœã‚¿ã‚¤ãƒ—</strong>: <span id="resultType" class="font-semibold text-indigo-700"></span></p>
            <p class="text-gray-700 mb-4"><strong>æœ€çµ‚åæ”¯</strong>: <span id="totalScore" class="text-lg font-bold text-green-700"></span>å††</p>

            <div id="rushInfoContainer" class="hidden pl-4 border-l-2 border-gray-300">
                <p class="text-gray-600 mb-1">- <strong>ãƒ©ãƒƒã‚·ãƒ¥å›æ•°</strong>: <span id="rushCount" class="font-semibold text-purple-700"></span>å›</p>
                <p class="text-gray-600">- ãƒ©ãƒƒã‚·ãƒ¥ä¸­ç²å¾—ç‚¹æ•°/ç‰æ•°: <span id="rawRushScore" class="font-semibold text-purple-700"></span></p>
            </div>
            
            <p class="text-blue-500 mt-4 text-sm">åˆ¥ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€å†åº¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div id="errorContainer" class="mt-8 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg hidden">
            <p><strong>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:</strong> <span id="errorMessage"></span></p>
            <p class="text-red-600 text-sm mt-2">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const revolutionsSlider = document.getElementById('revolutions');
        const revolutionsValueSpan = document.getElementById('revolutionsValue');
        const simulateButton = document.getElementById('simulateButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultContainer = document.getElementById('resultContainer');
        const hitNumSpan = document.getElementById('hitNum');
        const initialInvestmentSpan = document.getElementById('initialInvestment');
        const resultTypeSpan = document.getElementById('resultType');
        const totalScoreSpan = document.getElementById('totalScore');
        const rushInfoContainer = document.getElementById('rushInfoContainer');
        const rushCountSpan = document.getElementById('rushCount');
        const rawRushScoreSpan = document.getElementById('rawRushScore');
        const errorContainer = document.getElementById('errorContainer');
        const errorMessageSpan = document.getElementById('errorMessage');

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«è¡¨ç¤ºã‚’æ›´æ–°
        revolutionsSlider.addEventListener('input', () => {
            revolutionsValueSpan.textContent = revolutionsSlider.value;
        });

        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        simulateButton.addEventListener('click', async () => {
            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            resultContainer.classList.add('hidden');
            errorContainer.classList.add('hidden');
            loadingIndicator.classList.remove('hidden'); // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

            const revolutionsPer1000Yen = parseInt(revolutionsSlider.value);

            try {
                // Flaskãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                const response = await fetch('http://127.0.0.1:5000/simulate', { // Flaskã‚µãƒ¼ãƒãƒ¼ã®URLã¨ãƒãƒ¼ãƒˆ
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ revolutions_per_1000yen: revolutionsPer1000Yen }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    // çµæœã‚’è¡¨ç¤º
                    hitNumSpan.textContent = data.hit_num;
                    initialInvestmentSpan.textContent = data.initial_investment;
                    resultTypeSpan.textContent = data.result_type;
                    totalScoreSpan.textContent = data.total_score;

                    if (data.result_type === "ãƒ©ãƒƒã‚·ãƒ¥" || data.result_type === "å¼•ãæˆ»ã—") {
                        rushInfoContainer.classList.remove('hidden');
                        rushCountSpan.textContent = data.rush_info.rush_count;
                        rawRushScoreSpan.textContent = data.rush_info.raw_rush_score;
                    } else {
                        rushInfoContainer.classList.add('hidden');
                    }

                    resultContainer.classList.remove('hidden');
                } else {
                    errorMessageSpan.textContent = data.error || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
                    errorContainer.classList.remove('hidden');
                }

            } catch (error) {
                console.error("Fetch error:", error);
                errorMessageSpan.textContent = `ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                errorContainer.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden'); // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
            }
        });
    </script>
</body>
</html>
